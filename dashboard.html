<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sport Intelligence Dashboard | D3.js</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            --bg-color: #0d1117;
            --card-bg: #161b22;
            --border-color: #30363d;
            --text-main: #c9d1d9;
            --text-dim: #8b949e;
            --accent: #58a6ff;
        }

        body { 
            font-family: 'Segoe UI', Helvetica, Arial, sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-main); 
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
        }

        header { width: 100%; max-width: 900px; margin-bottom: 20px; text-align: center; }
        h1 { color: var(--accent); margin-bottom: 5px; font-size: 26px; }
        p.subtitle { color: var(--text-dim); margin-top: 0; font-size: 14px; }

        .chart-container { 
            background: var(--card-bg); 
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative;
        }

        .dot { 
            stroke: #fff; 
            stroke-width: 1.5px; 
            opacity: 0.9; 
            cursor: pointer; 
            transition: all 0.2s ease-in-out; 
        }

        .dot:hover { 
            opacity: 1; 
            stroke-width: 3px;
        }

        .axis-label text { fill: var(--text-dim); font-size: 12px; }
        .domain, .tick line { stroke: var(--border-color); }

        .tooltip { 
            position: absolute; 
            background: rgba(22, 27, 34, 0.95); 
            border: 1px solid var(--border-color); 
            padding: 12px; 
            border-radius: 8px; 
            color: white; 
            pointer-events: none; 
            opacity: 0; 
            font-size: 13px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            z-index: 10;
        }

        .legend {
            margin-top: 25px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            font-size: 12px;
            color: var(--text-dim);
            background: var(--card-bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .legend-item { display: flex; align-items: center; gap: 8px; }
        .key-dot { width: 14px; height: 14px; border-radius: 50%; border: 1px solid #fff; }
    </style>
</head>
<body>

    <header>
        <h1>Sport Intelligence Dashboard</h1>
        <p class="subtitle">Categorized Metadata Analysis of 21 Scraped Entities</p>
    </header>

    <div class="chart-container" id="chart"></div>

    <div class="legend">
        <div class="legend-item"><div class="key-dot" style="background: #1f6feb"></div> Football / Soccer (5)</div>
        <div class="legend-item"><div class="key-dot" style="background: #00d2ff"></div> Surf (6)</div>
        <div class="legend-item"><div class="key-dot" style="background: #f0f6fc"></div> Winter Sports (3)</div>
        <div class="legend-item"><div class="key-dot" style="background: #e3b341"></div> Baseball (4)</div>
        <div class="legend-item"><div class="key-dot" style="background: #f0883e"></div> Basketball (2)</div>
        <div class="legend-item"><div class="key-dot" style="background: #3fb950"></div> Golf (1)</div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const margin = {top: 40, right: 40, bottom: 60, left: 60};
        const width = 900 - margin.left - margin.right;
        const height = 450 - margin.top - margin.bottom;

        const svg = d3.select("#chart")
            .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

        d3.json("data.json").then(data => {
            const parseTime = d3.timeParse("%Y-%m-%d %H:%M:%S");
            
            data.forEach(d => {
                d.date = parseTime(d.timestamp);
                d.titleLen = d.title.length;
            });

            const x = d3.scaleTime()
                .domain(d3.extent(data, d => d.date))
                .range([0, width]).nice();

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.titleLen) + 10])
                .range([height, 0]);

            // UPDATED MULTI-COLOR CATEGORY LOGIC
            function getColor(title) {
                const t = title.toLowerCase();

                // Surf (Cyan) - Including 'Battle'
                if (t.includes("surf") || t.includes("billabong") || t.includes("rip curl") || t.includes("eddie") || t.includes("teahupoo") || t.includes("battle")) return "#00d2ff"; 
                // Winter Sports (White)
                if (t.includes("winter") || t.includes("snowboard") || t.includes("freeride")) return "#f0f6fc"; 
                // Basketball (Orange)
                if (t.includes("basketball") || t.includes("lakers") || (t.includes("nba") && !t.includes("bananas"))) return "#f0883e"; 
                // Baseball (Gold)
                if (t.includes("mets") || t.includes("dodgers") || t.includes("bananas") || t.includes("baseball")) return "#e3b341"; 
                // Golf (Green)
                if (t.includes("golf") || t.includes("pga")) return "#3fb950"; 
                // Football (Blue)
                if (t.includes("cup") || t.includes("fifa") || t.includes("miami") || t.includes("barcelona") || t.includes("concacaf")) return "#1f6feb"; 
                
                return "#8b949e";
            }

            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .attr("class", "axis-label");

            svg.append("g")
                .call(d3.axisLeft(y))
                .attr("class", "axis-label");

            const tooltip = d3.select("#tooltip");

            svg.selectAll(".dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("class", "dot")
                .attr("cx", d => x(d.date))
                .attr("cy", d => y(d.titleLen))
                .attr("r", 0)
                .style("fill", d => getColor(d.title))
                .on("mouseover", (event, d) => {
                    tooltip.transition().duration(200).style("opacity", 1);
                    tooltip.html(`<strong>Article:</strong> ${d.title}<br><strong>Chars:</strong> ${d.titleLen}<br><strong>Category:</strong> ${getCategoryName(d.title)}`)
                        .style("left", (event.pageX + 15) + "px")
                        .style("top", (event.pageY - 28) + "px");
                    
                    d3.select(event.currentTarget).attr("r", 14);
                })
                .on("mouseout", (event) => {
                    tooltip.transition().duration(500).style("opacity", 0);
                    d3.select(event.currentTarget).attr("r", 10);
                })
                .on("click", (e, d) => {
                    window.open(d.source_url, '_blank');
                })
                .transition()
                .duration(1000)
                .delay((d, i) => i * 30)
                .attr("r", 10);

            function getCategoryName(title) {
                const t = title.toLowerCase();
                if (t.includes("surf") || t.includes("billabong") || t.includes("rip curl") || t.includes("eddie") || t.includes("teahupoo") || t.includes("battle")) return "Surf";
                if (t.includes("winter") || t.includes("snowboard") || t.includes("freeride")) return "Winter Sports";
                if (t.includes("basketball") || t.includes("lakers") || (t.includes("nba") && !t.includes("bananas"))) return "Basketball";
                if (t.includes("mets") || t.includes("dodgers") || t.includes("bananas")) return "Baseball";
                if (t.includes("golf") || t.includes("pga")) return "Golf";
                if (t.includes("cup") || t.includes("fifa") || t.includes("miami") || t.includes("barcelona")) return "Football";
                return "General";
            }

            svg.append("text").attr("x", width / 2).attr("y", height + 45).style("text-anchor", "middle").style("fill", "#8b949e").text("Session Timeline");
            svg.append("text").attr("transform", "rotate(-90)").attr("y", -45).attr("x", -height / 2).style("text-anchor", "middle").style("fill", "#8b949e").text("Title Complexity");
        });
    </script>
</body>
</html>